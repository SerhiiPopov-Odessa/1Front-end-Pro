<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div class="container">
        <h1>ToDoList</h1>
        <form class="form js--form">
            <input id="form__input" type="text" name="value" required class="form__input js--form__input">
            <button class="form__btn_add_todo">Додати</button>
        </form>
        <ul class="js--todos-wrapper">
            <!-- <li class="todo-item">
                <input type="checkbox">
                <span class="todo-item__description">Text</span>
                <button class="todo-item__delete">Видалити</button>
            </li>
            <li class="todo-item todo-item--checked">
                <input type="checkbox">
                <span class="todo-item__description">Text</span>
                <button class="todo-item__delete">Видалити</button>
            </li> -->
        </ul>
        <template class="template-new-todo-item">
            <li class="todo-item">
                <input type="checkbox">
                <span class="todo-item__description">Text</span>
                <button class="todo-item__delete">Видалити</button>
            </li>
        </template>

        <script>
            const templateNewTodoItem = document.querySelector(".template-new-todo-item");
            const form = document.querySelector(".form");
            const todosWrapperUl = document.querySelector(".js--todos-wrapper");

            let todos = JSON.parse(localStorage.getItem('todos')) || [];

            function saveTodos() {
                localStorage.setItem('todos', JSON.stringify(todos));
            }

            function renderTodos() {
                todosWrapperUl.innerHTML = '';
                todos.forEach((todo, index) => {
                    newTodos(todo);
                });
            }

            function newTodos(todo = false) {
                const cloneTemplateNewTodoItem = templateNewTodoItem.content.cloneNode(true);
                const checkboxTodoItem = cloneTemplateNewTodoItem.querySelector('input[type="checkbox"]');
                const liTodoItem = cloneTemplateNewTodoItem.querySelector('li.todo-item');
                const spanTodoItem = cloneTemplateNewTodoItem.querySelector('span.todo-item__description');
                if (todo.checked) {
                    checkboxTodoItem.checked = true;
                    liTodoItem.classList.add('todo-item--checked');
                }
                else {
                    checkboxTodoItem.checked = false;
                }
                if (todo) {
                    spanTodoItem.textContent = todo.text;
                }
                else {
                    spanTodoItem.textContent = document.querySelector(".form__input").value.trim();
                }
                todosWrapperUl.append(cloneTemplateNewTodoItem);
            }

            todosWrapperUl.addEventListener('click', todosWrapperUlClick);
            function todosWrapperUlClick(event) {
                // Найдём ближайший LI (если кликнули внутри li)
                const li = event.target.closest('li');
                if (!li || !todosWrapperUl.contains(li)) return; // клик вне задач — игнорируем

                // Вычислим индекс li в списке UL
                const index = Array.from(todosWrapperUl.children).indexOf(li);
                if (index === -1) return;

                if (event.target.tagName === 'INPUT' && event.target.type === 'checkbox') {
                    if (event.target.checked) {
                        event.target.parentElement.classList.add('todo-item--checked');
                        todos[index].checked = true;
                    } else {
                        event.target.parentElement.classList.remove('todo-item--checked');
                        todos[index].checked = false;
                    }
                    saveTodos();
                }
                if (event.target.tagName === 'BUTTON' && event.target.classList.contains('todo-item__delete')) {
                    event.target.parentElement.remove();
                    todos.splice(index, 1);
                    saveTodos();
                }
                //todosWrapperUl.removeEventListener('click', todosWrapperUl_click);
            }

            form.addEventListener('click', formClickAddTodo);
            function formClickAddTodo(event) {
                event.preventDefault();
                if (event.target.tagName === "BUTTON") {
                    if (event.target.classList.contains('form__btn_add_todo')) {
                        const text = document.querySelector(".form__input").value.trim();
                        if (!text) {
                            alert('Введите текст')
                            return
                        };
                        newTodos()
                        todos.push({ text, checked: false });
                        saveTodos();
                        document.querySelector(".form__input").value = "";
                    }
                }
                //form.removeEventListener('click', form_click_add_todo);
            }
            renderTodos();
        </script>
    </div>
</body>

</html>